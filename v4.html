<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture Player</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.6.12/plyr.css" />
    <style>
        html, body {
            font-family: 'Poppins', sans-serif;
            background: #0A0909;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .circle {
            width: 20px;
            height: 20px;
            margin: 10px;
            border-radius: 50%;
            animation: loader-animation 0.75s ease infinite;
        }

        .circle:nth-child(1) {
            background-color: #D90429;
            animation-delay: 0s;
        }

        .circle:nth-child(2) {
            background-color: #FFA300;
            animation-delay: 0.15s;
        }

        .circle:nth-child(3) {
            background-color: #048BA8;
            animation-delay: 0.3s;
        }

        @keyframes loader-animation {
            0% {
                transform: scale(0);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 0;
            }
        }

        #videoContainer {
            width: 100vw;
            height: 100vh;
        }

        .plyr__controls .custom-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .custom-controls button {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 24px;
            color: #FFF;
        }

        .volume-slider {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            width: 20px;
            display: none;
        }
    </style>
</head>
<body>
<div id="loading">
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
</div>
<video id="videoContainer" controls></video>

<script src="https://cdnjs.cloudflare.com/ajax/libs/dashjs/3.1.3/dash.all.min.js"></script>
<script src="https://cdn.plyr.io/3.6.12/plyr.js"></script>
<script>
    const video = document.getElementById("videoContainer");

    document.addEventListener("DOMContentLoaded", function() {
        const source = "https://d1d34p8vz63oiq.cloudfront.net/bf2e55a0-18d1-41d1-827d-7312bf822648/master.mpd";

        const requestOptions = {
            method: 'GET',
            headers: new Headers({
                'Host': 'd1d34p8vz63oiq.cloudfront.net',
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0',
                'Accept': 'video/webm,video/ogg,video/*;q=0.9,application/ogg;q=0.7,audio/*;q=0.6,*/*;q=0.5',
                'Accept-Language': 'en-GB,en;q=0.5',
                'Range': 'bytes=0-',
                'Origin': 'https://lakshyajee.github.io',
                'Connection': 'keep-alive',
                'Referer': 'https://lakshyajee.github.io/',
                'Sec-Fetch-Dest': 'video',
                'Sec-Fetch-Mode': 'cors',
                'Sec-Fetch-Site': 'cross-site',
                'Accept-Encoding': 'identity',
                'TE': 'trailers'
            }),
            mode: 'cors',
            cache: 'default'
        };

        fetch(source, requestOptions)
            .then(response => {
                // Check if the response is successful
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(data => {
                const dash = dashjs.MediaPlayer().create();
                const clearkeysRegex = /const protData = ({.*?})/;
                const match = data.match(clearkeysRegex);
                
                if (match && match[1]) {
                    const clearkeysJson = match[1];
                    const clearkeysData = JSON.parse(clearkeysJson);

                    dash.initialize(video, source, false);
                    dash.setProtectionData({ "org.w3.clearkey": { "clearkeys": clearkeysData } });

                    dash.on("streamInitialized", function() {
                        const loadingElement = document.getElementById("loading");
                        loadingElement.style.display = "none";
                    });

                    dash.attachView(video);
                } else {
                    console.error('Clearkeys data not found in the server response');
                }
            })
            .catch(error => {
                console.error('Error fetching video:', error);
            });
    });

    // Rewind function
    function rewind() {
        if (!video.paused) {
            video.currentTime -= 10; // Rewind 10 seconds
        }
    }

    // Forward function
    function forward() {
        if (!video.paused) {
            video.currentTime += 10; // Forward 10 seconds
        }
    }
</script>

</body>
</html>
