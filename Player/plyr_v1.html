<!DOCTYPE html>

<html>

  <head>

    <!-- Shaka Player ui compiled library: -->

    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.9.2/dist/shaka-player.ui.js"></script>

    <!-- Shaka Player ui compiled library default CSS: -->

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/shaka-player@4.9.2/dist/controls.css">

    <!-- Chromecast SDK (if you want Chromecast support for your app): -->

    <script defer src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>

    

  </head>

  <body>

    <!-- The data-shaka-player-container tag will make the UI library place the controls in this div.

         The data-shaka-player-cast-receiver-id tag allows you to provide a Cast Application ID that

           the cast button will cast to; the value provided here is the sample cast receiver. -->

    <div data-shaka-player-container style="max-width:"

         data-shaka-player-cast-receiver-id="1BA79154">

       <!-- The data-shaka-player tag will make the UI library use this video element.

            If no video is provided, the UI will automatically make one inside the container div. -->

      <video autoplay data-shaka-player poster="https://peach.blender.org/wp-content/uploads/bbb-splash.png" id="video" style="width:100%;height:100%"></video>

    </div>
    <script disable-devtool-auto src='https://cdn.jsdelivr.net/npm/disable-devtool'></script>
   <script>
             /// Retrieve the URL parameters
const urlParams = new URLSearchParams(window.location.search);
const ext = urlParams.get('UI');

// Retrieve the modified URL from sessionStorage
let modifyUrl = sessionStorage.getItem('modifyUrl');

// Check if the 'UI' param is present in the URL
let manifestUri;
if (ext) {
    // Use the 'UI' param to construct the manifestUri
    manifestUri = `https://madxabhi-pw-78ab681aba3f.herokuapp.com/pp/${ext}/master.m3u8`;
    console.log('Using manifestUri from URL params:', manifestUri);
} else if (modifyUrl) {
    // If no 'UI' param, use the stored 'modifyUrl' from sessionStorage

    // Modify the URL for the final structure
    const finalModifyUrl = new URL(modifyUrl); // Parse modifyUrl to manipulate
    const url = finalModifyUrl.searchParams.get('url');
    const startTime = finalModifyUrl.searchParams.get('start_time');

    // Create the 2modifyurl with the required structure
    const modifyUrl2 = `${encodeURIComponent(url)}&start_time=${startTime}/`;

    // Set the manifestUri to the modified URL
    manifestUri = `${modifyUrl2}`;
    console.log('Using manifestUri from session storage (modified):', manifestUri);
} else {
    console.log('No live stream URL found in session storage or URL params.');
}

// Use manifestUri for initializing the player
if (manifestUri) {
    console.log('Playing live stream from:', manifestUri);
    // Logic to initialize the player with manifestUri
} else {
    console.log('Error: Unable to fetch the manifest URL.');
}


async function init() {

// When using the UI, the player is made automatically by the UI object.

const video = document.getElementById('video');

const ui = video['ui'];

const controls = ui.getControls();

const player = controls.getPlayer();

// Attach player and ui to the window to make it easy to access in the JS console.

window.player = player;

window.ui = ui;

// Listen for error events.

player.addEventListener('error', onPlayerErrorEvent);

controls.addEventListener('error', onUIErrorEvent);

// Try to load a manifest.

// This is an asynchronous process.

try {

await player.load(manifestUri);

// This runs if the asynchronous load is successful.

console.log('The video has now been loaded!');

} catch (error) {

onPlayerError(error);

}

}

function onPlayerErrorEvent(errorEvent) {

// Extract the shaka.util.Error object from the event.

onPlayerError(event.detail);

}

function onPlayerError(error) {

// Handle player error

console.error('Error code', error.code, 'object', error);

}

function onUIErrorEvent(errorEvent) {

// Extract the shaka.util.Error object from the event.

onPlayerError(event.detail);

}

function initFailed(errorEvent) {

// Handle the failure to load; errorEvent.detail.reasonCode has a

// shaka.ui.FailReasonCode describing why.

console.error('Unable to load the UI library!');

}

// Listen to the custom shaka-ui-loaded event, to wait until the UI is loaded.

document.addEventListener('shaka-ui-loaded', init);

// Listen to the custom shaka-ui-load-failed event, in case Shaka Player fails

// to load (e.g. due to lack of browser support).

document.addEventListener('shaka-ui-load-failed', initFailed);


    </script>

  </body>

</html>

